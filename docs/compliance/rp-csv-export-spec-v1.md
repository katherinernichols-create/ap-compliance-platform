# RP CSV Export Specification v1.0

**Date:** 30 November 2025  
**Status:** MVP Requirements Defined  
**Implementation:** Phase 2 (Post-January Demo)  
**Purpose:** Enable RPs to export AP worker compliance data for audit and Commission reporting

---

## Business Context

### Why RPs Need CSV Export

**Regulatory Requirement:** RPs must demonstrate "significant information and oversight" of AP compliance under the Aged Care Act 2024.

**Current Pain Point:** RPs maintain separate spreadsheets to track AP workers. Manual data entry = errors and out-of-date records.

**Solution:** Export button on RP dashboard → Download all AP workers as CSV → Import into RP's internal systems or provide to Commission auditors.

---

## MVP Requirements (What RPs MUST See)

For January 2026 demo, RPs need to be able to **prove** they have compliance oversight. Minimum viable export:

### Required Data Fields

| Column | Description | Example Value | Why Essential |
|--------|-------------|---------------|---------------|
| `ap_organisation_name` | AP business name | "Sunshine Care Services" | Identify which AP |
| `worker_name` | Worker full name | "Jane Smith" | Individual identification |
| `worker_role` | Job role | "Care Worker" | Determines credential requirements |
| `compliance_status` | Overall status | "Compliant" / "At Risk" / "Non-Compliant" | Quick risk assessment |
| `compliance_percentage` | Numeric score | "91" (91%) | Quantifiable metric |
| `credentials_expiring_soon` | Count expiring <90 days | "1" | Proactive risk flag |
| `credentials_expired` | Count expired | "0" | Immediate risk flag |
| `credentials_missing` | Count missing mandatory | "0" | Gap identification |
| `last_updated` | Data freshness | "2025-11-30" | Audit trail |

**Total Columns: 9** (intentionally minimal for MVP)

### File Format

Filename: {AP_Name}Compliance{YYYY-MM-DD}.csv
Example: SunshineCare_Compliance_2025-11-30.csv

Encoding: UTF-8 (supports special characters in names)
Delimiter: Comma (,)
Quote Character: Double quotes (") for fields containing commas
Header Row: Yes (column names in first row)
Date Format: YYYY-MM-DD (ISO 8601)

### Sample Output

ap_organisation_name,worker_name,worker_role,compliance_status,compliance_percentage,credentials_expiring_soon,credentials_expired,credentials_missing,last_updated
"Sunshine Care Services","Jane Smith","Care Worker","At Risk",91,1,0,0,2025-11-30
"Sunshine Care Services","Bob Johnson","Registered Nurse","Compliant",100,0,0,0,2025-11-30
"Sunshine Care Services","Sarah Lee","Care Worker","Non-Compliant",64,0,1,2,2025-11-30

---

## Phase 2: Enhanced Export (Post-MVP)

Once MVP validated, expand to include:

### Additional Columns (Phase 2)

| Column | Description | Why Deferred |
|--------|-------------|--------------|
| `credential_type` | Individual credential names | Too detailed for Phase 1 (creates 11+ rows per worker) |
| `credential_issue_date` | When credential obtained | Not critical for initial risk assessment |
| `credential_expiry_date` | When credential expires | RPs want summary counts first, not individual dates |
| `evidence_url` | Link to view certificate | Security/access concerns to resolve |
| `worker_email` | Contact info | Privacy - needs AP consent workflow |
| `worker_phone` | Contact info | Privacy - needs AP consent workflow |
| `days_until_expiry` | Calculated field | Nice-to-have, not essential |

### Advanced Filtering (Phase 2)

- Export only non-compliant workers
- Export only workers assigned to specific RP sites
- Export only credentials expiring in next 30 days
- Export with credential-level detail (pivot format)

### Bulk Export (Phase 2)

- "Export All APs" button on RP dashboard
- Generates multi-sheet Excel workbook (one sheet per AP)
- Includes summary statistics sheet

---

## Security & Privacy Considerations

### What NOT to Include (Ever)

❌ Worker home addresses  
❌ Worker date of birth  
❌ Worker TFN/ABN  
❌ Credential certificate numbers (e.g., Police Check reference numbers)  
❌ Internal AP notes/comments  
❌ AP contact details (unless AP explicitly shares)

### Access Control

- CSV export only available to authenticated RP users
- Only exports APs that have shared access with that specific RP
- No "export all APs in system" capability (privacy breach risk)
- Audit log: Track who exported what, when

### Data Freshness

- CSV represents "point in time" snapshot
- Include disclaimer in file: "Data accurate as of {date}. Check platform for real-time status."
- Consider adding "Generated by: {RP user email}" to filename for accountability

---

## Implementation Notes (For Developers)

### Phase 1 (MVP Demo)

**Option A: Manual CSV Generation (Fastest)**
- RP opens share link → Manually copies table → Pastes into Excel
- No code required, proves concept
- Demo script: "Phase 2 will have one-click export button here"

**Option B: Simple Export Button (If Time)**
- Add "Download CSV" button to US-009 (RP View AP Summary)
- Server-side: Query workers + compliance status, format as CSV
- Stream download to browser
- Estimated build time: 3 hours

**Recommendation for January demo:** Start with Option A, implement Option B if Week 4 has spare time.

### Phase 2 Implementation (February+)

**Tech Stack:**
- Backend: Next.js API route `/api/rp/export-csv`
- Library: `papaparse` or `csv-writer` (npm)
- File generation: Server-side (not client-side) for security
- Delivery: Signed S3 URL or direct download

**Pseudocode:**
// app/api/rp/export-csv/route.ts

export async function GET(request: Request) {
const { searchParams } = new URL(request.url);
const apOrgId = searchParams.get('ap_org_id');
const rpUserId = getCurrentRpUser(); // From auth

// Verify RP has access to this AP
const hasAccess = await verifyRpAccess(rpUserId, apOrgId);
if (!hasAccess) return new Response('Unauthorized', { status: 403 });

// Query workers with compliance calculation
const workers = await getWorkersWithCompliance(apOrgId);

// Format as CSV
const csvData = workers.map(w => ({
ap_organisation_name: w.organisation.name,
worker_name: w.name,
worker_role: w.role,
compliance_status: w.compliance.status,
compliance_percentage: w.compliance.percentage,
credentials_expiring_soon: w.compliance.expiring_count,
credentials_expired: w.compliance.expired_count,
credentials_missing: w.compliance.missing_count,
last_updated: new Date().toISOString().split('T')
}));

// Generate CSV string
const csv = generateCsv(csvData);

// Set download headers
const filename = ${sanitize(w.organisation.name)}_Compliance_${dateStamp}.csv;
return new Response(csv, {
headers: {
'Content-Type': 'text/csv',
'Content-Disposition': attachment; filename="${filename}",
},
});
}

---

## Testing Scenarios

### Test Case 1: Single AP Export
- RP has access to 1 AP (Sunshine Care) with 10 workers
- Click "Download CSV"
- **Expected:** `SunshineCare_Compliance_2025-11-30.csv` with 10 data rows + 1 header row

### Test Case 2: Multi-AP Export (Phase 2)
- RP has access to 5 APs
- Click "Export All"
- **Expected:** Single CSV with all workers from all 5 APs, grouped by AP name

### Test Case 3: Empty AP
- RP has access to AP with 0 workers
- Click "Download CSV"
- **Expected:** CSV with header row only, or message "No workers to export"

### Test Case 4: Special Characters
- Worker name contains comma: "O'Brien, Sarah"
- AP name contains quote: "Care "Excellence" Services"
- **Expected:** Properly escaped: `"O'Brien, Sarah"`, `"Care ""Excellence"" Services"`

---

## User Story Reference

**Relates to:**
- **US-009:** RP View AP Compliance Summary (where export button lives)
- **US-010:** RP View Worker Details (data source for export)
- **US-011:** RP Export Non-Compliant Workers (original scope, now Phase 2)

**Demo Script (January 2026):**
> "As an RP compliance manager, I can view all of Sunshine Care's workers in real-time. For our internal audit system, I click 'Download CSV' and get a spreadsheet with compliance status, expiring credentials, and risk flags. I can import this into our risk register or provide it to the Commission during audits. This replaces the 2-day email process we had before."

---

## Success Criteria

**Phase 1 (MVP):**
- ✅ RP can manually copy/paste table data into Excel (proves data availability)
- ✅ CSV spec documented and reviewed by pilot RP
- ✅ Demo includes "Phase 2: One-click export" slide

**Phase 2 (February):**
- ✅ Export button functional on RP dashboard
- ✅ CSV downloads with correct filename and format
- ✅ UTF-8 encoding handles special characters
- ✅ RPs can import CSV into Excel/Google Sheets without errors
- ✅ Audit log tracks all exports

---

## Open Questions (To Resolve Before Phase 2)

1. **Privacy:** Do we need AP approval before RP can export their data? (Probably yes via T&Cs)
2. **Frequency:** Rate limit exports (e.g., max 10 per day per RP user) to prevent scraping?
3. **Retention:** Do RPs want automated daily/weekly exports emailed? (Phase 3 feature?)
4. **Compliance:** Does Commission have preferred CSV format for their audits? (Research needed)

---

**Document Version:** 1.0 (MVP Spec)  
**Next Review:** After January 2026 demo feedback  
**Owner:** Kat (Technical), Anita (RP Requirements)
